<div class="light-gray">
    <div class="space"></div>
    <div class="container">

        <div class="row">

            <div class="col-12 col-lg-6">
                <div class="card card-rect shade-hover">
                    <div class="card-block header">
                        <h2 class="inline"><%= @contact.name %>
                            <% if @contact.long_term %>
                            <i class="fa fa-certificate orange-text" aria-hidden="true"></i>
                            <% end %>
                        </h2>

                        <div class="dropdown inline right float-right">
                            <i class="fa fa-chevron-down cursor gray-text" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></i>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                                <% if @contact.uninterested.nil? or not @contact.uninterested %>
                                    <%= bootstrap_form_for @contact do |f| %>
                                        <%= f.hidden_field :uninterested, value: true %>
                                        <%= f.submit "Mark as uninterested", class: "dropdown-item cursor orange-text-hover" %>
                                    <% end %>
                                <% else %>
                                    <%= bootstrap_form_for @contact do |f| %>
                                        <%= f.hidden_field :uninterested, value: false %>
                                        <%= f.submit "Mark as interested", class: "dropdown-item cursor orange-text-hover" %>
                                    <% end %>
                                <% end %>
                                <% if @contact.long_term.nil? or not @contact.long_term %>
                                    <%= bootstrap_form_for @contact do |f| %>
                                        <%= f.hidden_field :long_term, value: true %>
                                        <%= f.submit "Mark as long-term", class: "dropdown-item cursor orange-text-hover" %>
                                    <% end %>
                                <% else %>
                                    <%= bootstrap_form_for @contact do |f| %>
                                        <%= f.hidden_field :long_term, value: false %>
                                        <%= f.submit "Unmark as long term", class: "dropdown-item cursor orange-text-hover" %>
                                    <% end %>
                                <% end %>
                                <%= link_to 'Edit contact', edit_contact_path(@contact), class: "dropdown-item" %>
                                <div class="dropdown-divider"></div>
                                <%= link_to 'Delete contact', contact_path, method: :delete, data: { confirm: 'Permanently delete user?' }, class: "dropdown-item" %>
                            </div>
                        </div>
                    </div>
                    <div class="card-block header">
                        <p class="date small">Contact created
                            <%= @contact.created_at.to_date.to_formatted_s(:long_ordinal) %>
                        </p>
                        <p>
                            <%= @contact.role %>
                            <% if @contact.role.present? and @contact.company.present? %>
                            |
                            <% end %>
                            <%= @contact.company %>
                        </p>
                        <% if @contact.uninterested %>
                            <h4>This fool is uninterested</h4>
                        <% else %>
                            <h4>Contact is interested</h4>
                        <% end %>
                        <% if @contact.email.present? %>
                        <p>
                            <a href="mailto:<%=@contact.email%>">
                                <i class="fa fa-envelope" aria-hidden="true"></i>
                                <%= @contact.email %>
                            </a>
                        </p>
                        <% end %>
                        <% if @contact.secondary_email.present? %>
                        <p>
                            <a href="mailto:<%=@contact.secondary_email%>">
                                <i class="fa fa-envelope" aria-hidden="true"></i>
                                <%= @contact.secondary_email %>
                            </a>
                        </p>
                        <% end %>
                        <% if @contact.cell.present? %>
                        <p>
                            Cell:
                            <a href="tel:<%=@contact.cell%>">
                                <i class="fa fa-phone" aria-hidden="true"></i>
                                <%= @contact.cell %>
                            </a>
                        </p>
                        <% end %>
                        <% if @contact.work.present? %>
                        <p>
                            Work:
                            <a href="tel:<%=@contact.work%>">
                                <i class="fa fa-phone" aria-hidden="true"></i>
                                <%= @contact.work %>
                            </a>
                        </p>
                        <% end %>
                        <% if @contact.linkedin.present? %>
                        <p>
                            <a href="<%= @contact.linkedin %>" target="_blank">
                                <i class="fa fa-linkedin" aria-hidden="true"></i>
                            </a>
                        </p>
                        <% end %>
                        <% if @contact.facebook.present? %>
                        <p>
                            <a href="<%= @contact.facebook %>" target="_blank">
                                <i class="fa fa-facebook" aria-hidden="true"></i>
                            </a>
                        </p>
                        <% end %>
                    </div>
                    <!-- closing card block -->
                    <% if @contact.notes.present? %>
                    <div class="card-block">
                        <p class="gray-text"><%= @contact.notes %></p>
                    </div>
                    <% end %>
                </div>
                <!-- closing card -->
            </div>
            <!-- closing col -->

            <div class="col-12 col-lg-6">
                <div class="card card-rect shade-hover">
                    <div class="card-block">
                        <h4 class="center">Interaction over Time</h4>
                        <% outreach_sum = 0 %>
                        <% response_sum = 0 %>
                        <%= area_chart [ { name: "Responses", data: @responses.order("time").group("time").count.to_a.sort{|x,y| x[0] <=> y[0]}.map { |x,y| { x => (response_sum += y)} }.reduce({}, :merge) }, { name: "Outreaches", data:
                        @reaches.order("time").group("time").count.to_a.sort{|x,y| x[0] <=> y[0]}.map { |x,y| { x => (outreach_sum += y)} }.reduce({}, :merge) } ], xtitle: "Date", ytitle: "Reaches made", colors: ['#cc5200', '#ffa366'] %>
                    </div>
                </div>
            </div>

        </div>
        <!-- closing row -->

        <div class="row">
            <div class="col-12">
                <% if @contact.reaches.present? %>
                <h3 class="marg-bot-25">History</h3>

                <% reaches = @contact.reaches.sort_by &:time %>
                <% reaches.each do |reach| %>
                <% if reach.response %>
                <div class="reach response">
                <% else %>
                    <div class="reach">
                        <% end %>
                        <p class="date">
                            <%= reach.time.to_date.to_formatted_s(:long_ordinal) %>
                        </p>
                        <p class="notes">
                            <%= reach.notes %>
                        </p>
                        <% if current_user %>
                        <%= link_to contact_reach_path(@contact, reach), method: :delete do %>
                        <i class="fa fa-times-circle float-right delete" aria-hidden="true"></i>
                        <% end %>
                        <% end %>
                    </div>
                    <% end %>
                    <% end %>
                </div>
            </div>
        </div>
        <!-- closing row -->

        <div class="space"></div>
        <div class="space"></div>

        <!-- Modal -->
        <div class="modal fade" id="reachForm" tabindex="-1" role="dialog" aria-labelledby="New reach form" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Add new outreach</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <%= bootstrap_form_for [@contact, @contact.reaches.new] do |f| %>
                        <%= f.date_select :time, label: "Date" %>
                        <%= f.form_group :response do %>
                        <%= f.check_box :response %>
                        <% end %>
                        <%= f.text_area :notes, placeholder: 'Add a comment...', hide_label: true %>
                        <div class="buttons">
                            <%= f.submit "Create outreach", class: 'btn btn-outline-orange' %>
                        </div>
                        <% end %>
                    </div>
                </div>
            </div>
        </div>
        <!-- closing modal -->
    </div>
    <!-- closing container -->

    <a href="<%=new_contact_path%>" class="bottom-right" aria-hidden="true">
        <i class="fa fa-circle white-text icon-shade scale-down" aria-hidden="true"></i>
    </a>
    <a href="<%=new_contact_path%>" class="bottom-right" data-toggle="tooltip" data-placement="left" title="Add a new outreach">
        <i class="fa fa-plus-circle orange-text" data-toggle="modal" data-target="#reachForm" aria-hidden="true"></i>
    </a>
</div>
<!-- closing light-gray -->

<script type="text/javascript">
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })
</script>
